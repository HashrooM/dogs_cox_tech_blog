---
title: "【Googleデータポータル入門】Googleデータポータルでデータ分析"
date: 2021-05-16T13:51:52+09:00
description: "Googleデータポータルでテストデータを実際に分析してみます。"
draft: True
hideToc: false
enableToc: true
enableTocContent: false
author: DogsCox
tags:
- "BI tools"
- "Google Dataportal"
series:
- "How to use Google Dataportal"
categories:
- "Data Analysis"
---

[前回の記事]({{< ref "/posts/google_dataportal_setup.md" >}}) にて [Googleデータポータル](https://marketingplatform.google.com/intl/ja/about/data-studio/ "google_dataportal") にて分析をする準備を行いました。この記事では実際にテストデータの分析を行ってみます。  

まだデータをアップロードしていない場合は、以下の手順に従ってデータをGoogleデータポータルにアップロードしてください。（詳細は前回の記事をご覧ください。）

1. Google Drive上に [テストデータ](https://www.kaggle.com/ruchi798/movies-on-netflix-prime-video-hulu-and-disney "test") をアップロードして、右クリック → アプリで開く → スプレッドシートを選択してGoogleスプレッドシート形式で保存
1. Googleデータポータルにログインし、左側のメニューの "作成" → データソース → Googleスプレッドシートを選択
1. 先程Google Driveで作成したスプレッドシートを選択
1. （これは本記事の内容ですが）右上の "レポートを作成" をクリック


## "Movies on Netflix, Prime Video, Hulu and Disney+" データセットについて
本記事で扱うデータについて少し解説します。詳しい説明は [こちら](https://www.kaggle.com/ruchi798/movies-on-netflix-prime-video-hulu-and-disney "test") を参照してください。  

本データには放映された映画についての評価（ [IMDb](https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E3%83%BB%E3%83%A0%E3%83%BC%E3%83%93%E3%83%BC%E3%83%BB%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9 "imdb") や [Rotten Tomatoes](https://ja.wikipedia.org/wiki/Rotten_Tomatoes "rotton_toamtoes") のそれぞれの評価）と、動画視聴サービスNetflix, Amazon Prime Video, Hulu, Desney+において視聴可能かどうか、ジャンル等が格納されています。  
このデータを用いて、どの動画視聴サービスで評価の高い映画を観ることができるのか分析してみましょう。  

__注意__  
言うまでもありませんが、あくまでこの分析はデモです。  
現実において単純に「評価点が高い映画がたくさん見られるから良いサービスなんだ！！」と判断して、この記事の内容をもとにして動画視聴サービスに加入しないように。（しても構いませんが、そのサービスが期待通りでなかったとしても責任は取りません。）  
実際には映画のラインナップ以外にも各々の視聴サービスで特色があるので、各自の好みにあったものを選べば良いと思います。  
例えば、Netflixではオリジナルのドラマや映画を楽しみにしているユーザも多いと聞きますが、それらはおそらく映画評論サイトでの評価対象外のものもあるでしょうし。（そもそもドラマは映画評論サイトの対象外でしょう。）  
このように、あくまでデータは現実世界の一部のみを切り取ったものです。他のデータで実際に分析を行う際もこの点は頭に入れ、「こういう状況で取得されたこんなデータのもとではこういうことが言える。」と、結論には常に前提条件がついて回ることを忘れないようにしましょう。   


## 分析の目的
データはいかようにも分析できてしまうので、まずは「自分が何を知りたいか / 何が分かったらハッピーか」を決めましょう。  
今回はGoogleデータポータルのセットアップを最初に説明した都合上、データありきのような説明になってしまっていますが、本来は「自分が何を知りたいか / 何が分かったらハッピーか」を決めてからそれに見合ったデータを探す / 集める、という順序が良いかと思います。  
（実際は自分もテーマを決め、テーマにあったデータを見繕ってから前回と今回の記事を書いています。自分が映画好きなもので...）  
最も、データによっては分析を進める中で自分が期待していた以上のことが分かる可能性もあるので、目的は暫定的なものになることもあります。そこはデータ次第ですね。  

とりあえず、ここでは以下のような設定のもと、分析の目的を定めましょう。  

「あなたはこれから動画視聴サービスに加入しようとしていますが、どれに加入するか迷っています。まずは、人気作が多く視聴できるサービスがどれか知りたいと思っています。」  

ということで「人気作」がどのサービスでどれだけ視聴できるのか、分析してみましょう。  


## データを眺める
分析に踏み込む前に、まずはデータをざっくりと眺めてみましょう。これはGoogleデータポータルよりもGoogleスプレッドシートのほうが適しています（表形式で見られればエクセルでもなんでも良いです）。  
Googleアナリティクスのようにログが大量にある場合でも、一部だけでもファイルに出力して眺めてみることをオススメします。  
これにより、

- データの大まかな構造
- どんな列（カラム）にどんな量が入っているのか
    - 数値なのか、文字列なのかなど
- 欠損している値はあるのか
    - こちらについてはデータの一部のみを見ていては気づかないこともあるので、最終的にはSQLやR, Pythonなどできちっと調べたほうが良いですが...

あたりが分かります。  
今回のデータでは、映画ごとのIMDb、Rotten Tomatoesの評価と各サービスで視聴可能かどうか（0: 視聴不可、1: 視聴可とフラグ付けられているのが分かります）が分かりますね。人気作 = 評価点が高い作品 として扱えそうです。  
他に、映画の監督、ジャンル、国、言語、放映時間も分かりますね。![data spreadsheet](/images/google_dataportal_eda/data_spreadsheet.png "data_spreadsheet")  
お気に入りのジャンルや贔屓の監督などの人気作に絞り込んでより自分の興味にあった情報を取得できそうです。  
ただ、ジャンルや言語はいくつかの要素がカンマで区切られているので、単純に要素を指定するだけではダメそうです。ジャンルの `Action` だけを指定すると `Action,Sci-Fi` のように複数要素の中に `Action` も含まれる、という場合を見逃してしまいます。  
「特定の文字列 (`Action`) がジャンルに含まれるか」をどうにか表現しないとジャンルや言語をうまく扱えなさそうである、と分かります。

また、値の欠損があることも分かります。監督やジャンルなどはしょうがないとして、IMDbやRotten tomatoesの評価点にも欠損が含まれています。今回の分析では評価点が欠損しているデータは残念ながら使えなさそうです。  
とはいえ、今回は人気作 = 評価点の高い作品に興味があるので、このような評価点が欠損しているデータは無視してしまっても良いかもしれません。なにか分析の際に問題を引き起こすようなら対処しましょう。一旦欠損は無視して進めます。  
（株価のような時系列データの場合は欠損値は何らかの方法で処理したほうが良いでしょう。）  


## データの重複をチェック、削除する
ここで一つ注意です。 __Googleデータポータルで分析するデータは重複を含まないようにしましょう。__  
重複を含んだデータはうまく集計できないことがあります。慣れてくれば [関数](https://support.google.com/datastudio/table/6379764?hl=ja "functions") や [このような方法](https://fm-aid.com/bbs2/viewtopic.php?id=3701 "del_dup") で対処できるかもしれませんが、間違いを防止するためにも、重複は除いておいたほうが無難です。  

さて、「何を重複とみなすか」は分析の目的や方法によります。完全に同じ行が存在していると当然それは重複ですが、場合によってはカラムの一部が同じだけでも重複とみなすべきときもあります。  
今の映画データの場合もいくつか重複の定義が思いつきますが、「タイトルが重複している行を重複とみなす」としましょう。  
評価点の上位5位くらいまでのリストを作成した際に、同じタイトルが3つ入っていたりしたら困りますよね。  

今回のデータは "ID" 列が映画1つにつき1つの値となっているので、IDの最大値（最終行になります）とスプレッドシート上の列数を見れば重複がないことがすぐに分かります。  
ぱっとわからない場合にはGoogleスプレッドシート上でもできる方法がいくつかあるので、参考にしてみてください。

- [表内の重複するデータを取り除きたい！ COUNTIF関数でダブりを発見・UNIQUE関数でクリーンな表を作る方法](https://forest.watch.impress.co.jp/docs/serial/googlesps/1216354.html "del_dup_countif")
- [Googleスプレッドシートで重複チェックをスマートにする方法](https://moto.hatenadiary.com/entry/2018/12/02/192131 "del_dup_cond")
- [【新機能】スプレッドシートで重複を削除する](https://spread-sheets.com/useful/data/remove-duplicates/ "del_dup_spreadsheet")

実際は「重複があった場合、どの行を残すか / どのように単一の行にするか」という問題が残るため、プログラミング言語で柔軟に対処したほうが良い場合もあるかもしれません。  


## Googleデータポータルによるデータ分析 
それではGoogleデータポータルを用いて分析してみましょう。  
この記事の最初に述べたような手順でデータソースに接続すると、右上に "レポートを作成" と "探索" のボタンが現れます。今回は "レポートの作成" をクリックします。  
すると、次のような画面が新しいタブで開かれます。 ![report first](/images/google_dataportal_eda/report_first.png "report_first")  

これは画面右側の "グラフ" から表が選択され、データ内の "Title" がそれぞれ何行ずつあるか（"Title"ごとのレコード数) を表示するグラフが既に作成されていることを表しています。  
この表を色々いじってみると使い方に慣れることができるような気もしますが、とりあえず今回はタイトルごとに重複がないため、全ての値が1になることが分かっています。なので、この表は削除してしまいましょう。　　
表をクリックしてバックスペースで直感的に削除することができます。  
また、画面左上が "無題のレポート" となっていますが、クリックすると修正することができるので任意の名前を付けてあげましょう。今回は "movie_test" という名前にしました。  

使い方ですが、Googleデータポータルは基本的に、

1. グラフを選択する（円グラフ、折れ線グラフなど）
1. "ディメンション" (データのカラムのことと思って大丈夫です) を選択する
1. ディメンションを集計する指標を作成、選択する
1. 必要に応じてフィルタで絞り込む
1. グラフもしくは表がレポート内に作成される

という流れでレポートを作成していきます。  
さて、ここからは実際に映画データを分析していくわけですが、以下のような流れで行っていきます。  

1. IMDb, Rotten tomatoesそれぞれで評価点の高い映画を選出
1. 各視聴サービスが評価点の高い映画のうち何%を視聴できるのか集計
1. （発展）言語、ジャンルによるフィルタリングを追加

それでは、初めましょう。  

### 評価点の高い映画を選出


